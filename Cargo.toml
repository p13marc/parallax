[workspace]
members = [".", "parallax-macros", "examples/example-plugin"]

[package]
name = "parallax"
version = "0.1.0"
edition = "2024"
rust-version = "1.85"
description = "A Rust-native streaming pipeline engine with zero-copy multi-process support"
license = "MIT OR Apache-2.0"
repository = "https://github.com/example/parallax"
keywords = ["streaming", "pipeline", "zero-copy", "dataflow"]
categories = ["multimedia", "asynchronous", "data-structures"]

[dependencies]
# Async runtime
tokio = { version = "1", features = ["rt-multi-thread", "net", "fs", "io-util", "macros", "sync"] }

# Channels (fast, MPMC, sync+async)
kanal = "0.1"

# Graph structure (enforces DAG)
daggy = { version = "0.9", features = ["stable_dag"] }

# Parsing
winnow = "0.7"

# Serialization (zero-copy)
rkyv = { version = "0.8", features = ["bytecheck"] }
serde = { version = "1", features = ["derive"] }
serde_json = "1"

# Buffer utilities
bytes = "1"
smallvec = "1"

# Error handling
thiserror = "2"
anyhow = "1"

# Metrics & logging
metrics = "0.24"
tracing = "0.1"
tracing-subscriber = { version = "0.3", features = ["env-filter"] }

# Linux system APIs (memfd, mmap, SCM_RIGHTS)
rustix = { version = "1.0", features = ["mm", "fs", "net", "process", "pipe", "stdio"] }
futures = "0.3.31"
libloading = "0.8.9"
paste = "1.0.15"

# Proc macros (optional, for plugin authoring convenience)
parallax-macros = { path = "parallax-macros", optional = true }

# HTTP client (optional)
ureq = { version = "2", optional = true }

# WebSocket (optional)
tungstenite = { version = "0.21", optional = true }

# Zenoh pub/sub (optional)
zenoh = { version = "1.0", optional = true }

# Regex (for RegexFilter)
regex = "1"

[dev-dependencies]
tokio-test = "0.4"
criterion = "0.6"
proptest = "1"
tempfile = "3.24.0"

[features]
default = []
macros = ["parallax-macros"]  # Plugin authoring macros
huge-pages = []       # MAP_HUGETLB support
io-uring = []         # Future: io_uring async I/O
gpu = []              # Future: CUDA/Vulkan pinned memory
rdma = []             # Future: RDMA support
http = ["ureq"]       # HTTP source/sink elements
websocket = ["tungstenite"]  # WebSocket source/sink elements
zenoh = ["dep:zenoh"] # Zenoh pub/sub elements

[[bench]]
name = "throughput"
harness = false

[[bench]]
name = "memory_pool"
harness = false
